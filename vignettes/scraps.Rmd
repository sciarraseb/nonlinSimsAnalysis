---
shorttitle        : "Measurement timing"
format          : "pandoc"
header-includes:
  - \usepackage{nccmath}
  - \usepackage{caption}
  - \usepackage{textcomp} #for copyright symbol on title page
  - \usepackage{longtable}
  - \usepackage{setspace}
  - \usepackage{biblatex}
  - \usepackage{booktabs}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
  - \usepackage{amsthm} 
  - \usepackage{amsmath} ##needed for argmax
  - \DeclareMathOperator*{\argmax}{arg\,max}
  - \usepackage{setspace} #needed to doublespace caption text (using \doublespacing)
  - \usepackage[labelfont = {bf, up}]{caption} 
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
  - \usepackage{upgreek}  #required for non-italicized Greek letters
  - \usepackage{subcaption}
  - \captionsetup[figure]{labelfont={normalfont, bf}, singlelinecheck=false, labelsep=newline}
  - \DeclareCaptionJustification{double}{\DoubleSpacing}
  - \DeclareCaptionFont{figCaptionFont}{\fontfamily{phv}} #sets caption font to sans serif font of Helvetica 
  - \DeclareCaptionFont{figCaptionSize}{\footnotesize} #set caption font size to footnote 
  - \DeclareCaptionFont{figCaptionStyle}{\textup}  #set caption font to non-italicized font  
  - \DeclareCaptionLabelSeparator{captionSep}{\newline\newline} #separates figure label and figure title with required white space
  - \captionsetup[figure]{labelfont={figCaptionStyle, bf}, font = {figCaptionFont,figCaptionSize, figCaptionStyle}, labelsep = captionSep, justification=raggedright}
  - \captionsetup[table]{font = {figCaptionFont,figCaptionSize,figCaptionStyle}, labelfont={bf}, labelsep=captionSep, justification = raggedright, margin = {0cm,0cm}}
  - \newenvironment{helvenv}{\fontfamily{phv}\selectfont}{}
  - \raggedbottom #ensures text starts from top of page and any white space is at the botom

#environment numbering 
  - \setcounter{section}{0} 
  - \makeatletter \renewcommand\thesection{} \renewcommand\thesubsection{\@arabic\c@section.\@arabic\c@subsection} \makeatother
  
  - \newtheorem{theorem}{Theorem}
  - \newtheorem{example}[theorem]{Example}
  
  #modifies heading levels of 4-5 to follow apa7
  - |
    \makeatletter
    \renewcommand{\paragraph}{\@startsection{paragraph}{4}{\parindent}%
      {0\baselineskip \@plus 0.2ex \@minus 0.2ex}%
      {-1em}%
      {\normalfont\normalsize\bfseries\typesectitle}}
    
    \renewcommand{\subparagraph}[1]{\@startsection{subparagraph}{5}{1em}%
      {0\baselineskip \@plus 0.2ex \@minus 0.2ex}%
      {-\z@\relax}%
      {\normalfont\normalsize\bfseries\itshape\hspace{\parindent}{#1}\textit{\addperi}}{\relax}}
    \makeatother

  
author: 
  - name          : "Sebastian Sciarra "
    affiliation   : "1"
    corresponding : yes    
    email         : "ssciarra@uoguelph.ca"
affiliation: 
  - id            : "1"
    institution   : "University of Guelph"
keywords          : "measurement timing, nonlinear "
wordcount         : "5554 words"
floatsintext      : yes
linkcolor         : blue
figsintext        : yes 
figurelist        : no
tablelist         : no
footnotelist      : no
numbersections    : yes
linenumbers       : yes
mask              : no
draft             : no
documentclass     : "apa7"
csl               : "`r system.file('rmd', 'apa7.csl', package = 'papaja')`"
classoption       : "man"
output            : papaja::apa6_pdf
editor_options: 
  markdown: 
    wrap: 72
bibliography: dissertation_references.bib
---

```{r package_loading, include=F}
#load packages
library(easypackages)
packages <- c('devtools','tidyverse', 'RColorBrewer', 'parallel', 'data.table', 'kableExtra', 'ggtext', 'egg', 'nonlinSims','papaja', 
              'ggbrace', 'cowplot')
libraries(packages)
load_all()
```

```{r knitting_setup, echo=F, message = F, warning = F, eval=F}
#import raw data files (needed for computing variances)
exp_1_raw <-convert_raw_var_to_sd(raw_data = read_csv('Data/exp_1A.csv')) %>%
  mutate_at(.vars = c("number_measurements", "measurement_spacing", "midpoint"), factor)
  
exp_2_raw <-convert_raw_var_to_sd(raw_data = read_csv('Data/exp_2.csv')) %>%
  mutate_at(.vars = c("number_measurements", "measurement_spacing", "sample_size"), factor)

exp_3_raw <-convert_raw_var_to_sd(raw_data = read_csv('Data/exp_3.csv')) %>%
  mutate_at(.vars = c("number_measurements", "time_structuredness", "sample_size"), factor)

#unfiltered data 
param_summary_exp_1 <- readRDS(file = 'data/uf_param_summary_exp_1.RData')
param_summary_exp_2 <- readRDS(file = 'data/uf_param_summary_exp_2.RData')
param_summary_exp_3 <- readRDS(file = 'data/uf_param_summary_exp_3.RData')

#create analytical versions of summary data 
exp_1_analytical <- generate_likert_days_data_sets(summary_data = param_summary_exp_1, exp_num = 1)
exp_2_analytical <- generate_likert_days_data_sets(summary_data = param_summary_exp_2, exp_num = 2)
exp_3_analytical <- generate_likert_days_data_sets(summary_data = param_summary_exp_3, exp_num = 3)

#create condition summary data sets 
cond_summary_exp_1 <- compute_condition_summary(param_summary_data = param_summary_exp_1, facet_var = 'measurement_spacing', 
                          ind_vars = c('number_measurements', 'measurement_spacing', 'midpoint'))
cond_summary_exp_2 <- compute_condition_summary(param_summary_data = param_summary_exp_2, facet_var = 'measurement_spacing', 
                  ind_vars = c('number_measurements', 'measurement_spacing', 'sample_size'))
cond_summary_exp_3 <- compute_condition_summary(param_summary_data = param_summary_exp_3, facet_var = 'time_structuredness', 
                          ind_vars = c('number_measurements', 'sample_size', 'time_structuredness'))
```

```{r ergodicity, include=F, eval=F}
num_people <- 100 
num_occasions <- 100

data_set_1 <- matrix(data = list('ID' = NA, 
           'occasion' = NA), 
           nrow = num_people, ncol = num_occasions) 

data_set_2 <- matrix(data = list('ID' = NA, 
           'occasion' = NA), 
           nrow = num_people, ncol = num_occasions) 

for (person in 1:num_people) {
  
  #homogeneity = same mean and SD across all people 
  #stationarity = constant mean and variance over time 
  data_set_1[person, ] <- rnorm(n = num_occasions, mean = runif(n = 1, min = 5, max = 50), 
                              sd = runif(n = 1, min = 2, max = 5))
}

for (person in 1:num_people) {
  
  #homogeneity = same mean and SD across all people 
  #stationarity = constant mean and variance over time 
  data_set_2[person, ] <- rnorm(n = num_occasions, mean = runif(n = 1, min = 5, max = 50), 
                              sd = runif(n = 1, min = 2, max = 5))
}

mode(data_set_1) <- 'numeric'
data_df <- as.data.frame(x = data_set_1)

mode(data_set_2) <- 'numeric'
data2_df <- as.data.frame(x = data_set_2)

var(rowMeans(data_df))
var(colMeans(data_df))

##BETWEEN PERSON VARIANCE
mean_value <- mean(colMeans(data_df)) 
between_var <- sum((rowMeans(data_df) - mean_value)^2)/100

##WITHIN PERSON VARIANCE
within_var <- mean(apply(X = data_df, MARGIN = 1, FUN = var)) #person 

##total_variance
total_var <- var(unlist(data_df))



within_cors <- rep(NA, times = num_people)

#compute correlations within people 
for(person in 1:num_people) {
  
  within_cors[person] <- cor(as.numeric(data_df[person, ]), as.numeric(data2_df[person, ]))
}

between_cors <- rep(NA, times = num_people)

#compute correlations between people 
for(occasion in 1:num_occasions) {
  
  between_cors[occasion] <- cor(as.numeric(data_df[ ,occasion]), as.numeric(data2_df[ ,occasion]))
}

sd(within_cors)
sd(between_cors)

mean(within_cors)
mean(between_cors)

mean(rowMeans(data_df))
mean(colMeans(data_df[sample(x = 1:100, size = 60, replace = F), ]))

sqrt(mean(apply(X = data_df, MARGIN = 2, FUN = var))) #variable sds
sqrt(mean(apply(X = data_df, MARGIN = 1, FUN = var))) #person sds
```

```{=tex}
\newpage
\vspace*{-\topskip}
\vspace*{\fill}
\nointerlineskip
```

10.1037/a0019365

### Summary 

Importantly, 
1000 data sets were generated for each cell (*n* = 1000), and so 48 000 data sets were generated for the 48 cells in Experiment 1, 96 000 data sets were generated for the 96 cells in Experiment 2, and 72 000 data sets were generated for the 72 cells in Experiment 3.

```{r experimentOverview, echo=F}

exp_overview_df <- data.frame(
'\\textbf{Experiment 1}'= c(
'\\hspace{2pc}IV1: Number of measurements (5, 7, 9, 11)',
'\\hspace{2pc}IV2: Spacing of measurements (equal, time-interval increasing, time-interval decreasing, middle-and-extreme)',
'\\hspace{2pc}IV3: Nature of change (fixed-effect days-to-halfway elevation parameter $\\upbeta_{fixed}$ value of 80, 180, or 280)',
'\\hspace{2pc}DV1: Convergence success rate',
'\\hspace{2pc}DV2: Percent bias',
'\\hspace{2pc}Constants: time-structured data, sample size (\\textit{N} = 225), independent and identically distributed errors, no missing data', 
'\\hspace{2pc}Number of data sets: 48 000',

'\\textbf{Experiment 2 (see Cells 5 \\& 9 of Table @ref(tab:systematicReviewCount-exp))}',
'\\hspace{2pc}IV1: Number of measurements (5, 7, 9, 11)',
'\\hspace{2pc}IV3: Spacing of measurements (equal, time-interval increasing, time-interval decreasing, middle-and-extreme)',
'\\hspace{2pc}IV2: Sample size (30, 50, 100, 200, 500, 1000)',
'\\hspace{2pc}DV1: Convergence success rate',
'\\hspace{2pc}DV2: Percent bias',
'\\hspace{2pc}Constants: fixed-effect days-to-halfway elevation parameter ($\\upbeta_{fixed}$ = 180), time-structured data, independent and \\phantom{andd}identically distributed errors, no missing data', 
'\\hspace{2pc}Number of data sets: 96 000',


'\\textbf{Experiment 3 (see Cells 1 \\& 10 of Table @ref(tab:systematicReviewCount-exp))}',
'\\hspace{2pc}IV1: Number of measurements (5, 7, 9, 11)',
'\\hspace{2pc}IV2: Sample size (30, 50, 100, 200, 500, 1000)',
'\\hspace{2pc}IV3: Time structuredness (time-structured data, fast response rate, slow response rate) ',
'\\hspace{2pc}DV1: Convergence success rate',
'\\hspace{2pc}DV2: Percent bias',
'\\hspace{2pc}Constants: fixed-effect days-to-halfway elevation parameter ($\\upbeta_{fixed}$ = 180), measurement spacing (equal), independent and \\phantom{andd}identically distributed errors, no missing data', 
'\\hspace{2pc}Number of data sets: 72000'

), check.names = F)

kbl(x = exp_overview_df, format = 'latex', caption = 'Summary of Simulation Experiments', 
    align = 'l', 
    toprule = '\\cmidrule[\\heavyrulewidth](r{5cm}){1-1}', 
    midrule = '\\cmidrule(r{5cm}){1-1}',
    bottomrule = '\\cmidrule[\\heavyrulewidth](r{5cm}){1-1}', 
booktabs = T, longtable = T, escape=F,
linesep = c(rep('', times = 6),
            '\\addlinespace\\addlinespace\\cmidrule(r{5cm}){1-1}', '\\cmidrule(r{5cm}){1-1}', 
            rep('', times = 6), 
            '\\addlinespace\\addlinespace\\addlinespace\\cmidrule(r{5cm}){1-1}','\\cmidrule(r{5cm}){1-1}', 
            rep('', times = 6), 
            '\\addlinespace\\addlinespace\\cmidrule(r{5cm}){1-1}', '\\cmidrule(r{5cm}){1-1}',
            rep('', times = 7))) %>% 
  kable_styling(position = 'left') %>%

footnote(general = 'A 1000 data sets will be generated for each
condition (\\\\textit{n} = 1000) in each simulation experiment. \\\\phantom{filler content to set alignmentfiller content to set alignment}', 
         general_title = '\\\\textit{Note.\\\\hspace{-1pc}}', escape = F) %>%
row_spec(row = 8, background = '#9fc5e8') %>%
  column_spec(column = 1, width = '23.3cm') %>%
  #cell_spec(x = exp_overview_df[8, ], background = '#9fc5e8', latex_background_in_cell = T) %>%
row_spec(row = 16, background = '#9fc5e8') %>%
landscape(margin = '2cm') 
```

Because the study by @coulombe2016 represented the most comprehensive investigation into the effects of longitudinal design and analysis factors on modelling accuracy (see Table \ref{tab:systematicReview}), the
independent variable manipulations used in the current simulation experiments largely mirrored the
independent variable manipulations from @coulombe2016. As a reference,
Table \ref{tab:coulombe2016} lists the levels used for the independent
variables in @coulombe2016. One last point to mention is that the
independent variable manipulations were computed in the context of a
360-day period since many organizational processes are governed by
annual events (e.g., performance reviews, annual returns, regulatory
processes, etc.). Table \ref{tab:myValues} lists the levels used for
the independent variables in my simulations experiments.

(ref:coulombe2016) @coulombe2016

```{r coulombe2016, echo=F}

coulombe_df <- data.frame('Independent variable' = c('Number of measurements (NM)', 'Time structuredness (TS)', 'Sample size (S)'), 
                          'Levels' = c('3, 5, 7, 9', '40\\%, 100\\% of response window length', '30, 50, 100, 200, 500'), check.names = F)

kbl(x = coulombe_df, booktabs = TRUE, format = 'latex', longtable = T, 
      align = c('l', 'c'),
      caption = 'Levels Used for Independent Variables in (ref:coulombe2016)', 
    escape=F) %>%
   kable_styling(latex_options= c('hold_position'), font_size = 10, position =
                   'left')
```

```{r myValues, echo=F}
 myValues_df <- data.frame('Independent variabe' = c('Number of measurements (NM)', 'Time structuredness (TS)', 'Sample size (S)', 'Measurement spacing (MS)', 'Nature of change (population value set for the fixed-effect days-to-halfway elevation parameter [$\\upbeta_{fixed}$])'), 
                          'Levels' = c('5, 7, 9, and 11', 
                                       'Time structured, fast response rate ($a_{fast}$ = 0.37), and slow response rate ($a_{slow}$ = 0.15)', 
                                       '30, 50, 100, 200, 500, and 1000', 
                                       'Equal, time-interval increasing, time-interval decreasing, middle-and-extreme', 
                                       '80, 180, and 280 days'), check.names = F)

kbl(x = myValues_df, booktabs = TRUE, format = 'latex', longtable = T, 
      align = c('l', 'l'),
      caption = 'Levels Used for Independent Variables in my Simulations', 
    escape=F) %>%
  column_spec(column = 1, width = '6cm') %>%
  column_spec(column = 2, width = '10cm') %>%
   kable_styling(latex_options= c('hold_position', 'repeat_header'), font_size = 10, position = 'left')
```
# References

```{=tex}
\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
```
::: {#refs custom-style="Bibliography"}
:::

```{=tex}
\endgroup
```
