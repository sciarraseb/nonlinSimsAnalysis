---
title: "tutorial_analysis"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{tutorial_analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
header-includes:
  - \usepackage{upgreek}  #required for non-italicized Greek letters
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


```{r package_loading, echo=F}
library(easypackages)
packages <- c('nonlinSimsAnalysis', 'tidyverse', 'data.table', 'parallel', 'devtools', 'ggtext', 'egg', 'kableExtra')
libraries(packages)

load_all()
```

```{r pre_knitting_setup, echo=F, eval=F}
#code should be computed before knitting to decrease knitting time 
#load data from experiments
exp_1 <- read_csv(file = 'data/exp_1A.csv') 
exp_2 <- read_csv(file = 'data/exp_2.csv')
exp_3 <- read_csv(file = 'data/exp_3.csv')

#data cleaning procedure for each data set
#filter out values for each parameter under each condition 
exp_1_filtered <- remove_outliers(data = exp_1)
exp_2_filtered <- remove_outliers(data = exp_2)
exp_3_filtered <- remove_outliers(data = exp_3)
  
#convert variance values to SD values for random effect parameters 
exp_1_cleaned <- convert_var_to_sd(data = exp_1_filtered)
exp_2_cleaned <- convert_var_to_sd(data = exp_2_filtered)
exp_3_cleaned <- convert_var_to_sd(data = exp_3_filtered)

#compute summary values 
param_summary_exp_1 <- compute_parameter_summary(data = exp_1_cleaned, exp_num = 1)
param_summary_exp_2 <- compute_parameter_summary(data = exp_2_cleaned, exp_num = 2)
param_summary_exp_3 <- compute_parameter_summary(data = exp_3_cleaned, exp_num = 3)

#save parameter summary files as RData files so that metadata are correctly stored (e.g., factor levels, variable types)
saveRDS(object = param_summary_exp_1, file = 'data/param_summary_exp_1.RData')
saveRDS(object = param_summary_exp_2, file = 'data/param_summary_exp_2.RData')
saveRDS(object = param_summary_exp_3, file = 'data/param_summary_exp_3.RData')
```

```{r obsolete_metadata_storing_importing, echo=F, eval=F}
#store classes of each column 
col_types_exp_1 <- unlist(lapply(X = param_summary_exp_1, FUN = class))
col_types_exp_2 <- unlist(lapply(X = param_summary_exp_2, FUN = class))
col_types_exp_3 <- unlist(lapply(X = param_summary_exp_3, FUN = class))

#create data.frame that stores classes of data columns 
col_types_df <- data.frame('exp_num' = c(rep(x = 1, times = length(col_types_exp_1)),
                                         rep(x = 2, times = length(col_types_exp_2)),
                                         rep(x = 3, times = length(col_types_exp_3))), 
                           'variable_types' = c(col_types_exp_1, col_types_exp_2, col_types_exp_3))

#create data fame that stores levels of factor variables 
exp_1_factor_levels <- extract_factor_levels(param_summary_data = param_summary_exp_1)
exp_2_factor_levels <- extract_factor_levels(param_summary_data = param_summary_exp_2)
exp_3_factor_levels <- extract_factor_levels(param_summary_data = param_summary_exp_3)

#write summary data  
write_csv(x = param_summary_exp_1, file = 'data/param_summary_exp_1.csv')
write_csv(x = param_summary_exp_2, file = 'data/param_summary_exp_2.csv')
write_csv(x = param_summary_exp_3, file = 'data/param_summary_exp_3.csv')

#write meta data + data for factor levels 
write_csv(x = col_types_df, file = 'data/col_types.csv')
write_csv(x = exp_1_factor_levels, file = 'data/exp_1_factor_levels.csv')
write_csv(x = exp_2_factor_levels, file = 'data/exp_2_factor_levels.csv')
write_csv(x = exp_3_factor_levels, file = 'data/exp_3_factor_levels.csv')

#read in .csv files with experimental data already in summarized version 
col_types_df <-read_csv(file = 'data/col_types.csv')
exp_1_factor_levels <- read_csv(file = 'data/exp_1_factor_levels.csv')
exp_2_factor_levels <- read_csv(file = 'data/exp_2_factor_levels.csv')
exp_3_factor_levels <- read_csv(file = 'data/exp_3_factor_levels.csv')

#import summary data files 
param_summary_exp_1 <- read.csv(file = 'data/param_summary_exp_1.csv', colClasses = col_types_df$variable_types[col_types_df$exp_num == 1])
param_summary_exp_2 <- read.csv(file = 'data/param_summary_exp_2.csv',  colClasses = col_types_df$variable_types[col_types_df$exp_num == 2])
param_summary_exp_3 <- read.csv(file = 'data/param_summary_exp_3.csv', colClasses = col_types_df$variable_types[col_types_df$exp_num == 3])

#relevel factors columns 
param_summary_exp_1 <- relevel_factors(param_summary_data = param_summary_exp_1, factor_levels_df = exp_1_factor_levels)
param_summary_exp_2 <- relevel_factors(param_summary_data = param_summary_exp_2, factor_levels_df = exp_2_factor_levels)
param_summary_exp_3 <- relevel_factors(param_summary_data = param_summary_exp_3, factor_levels_df = exp_3_factor_levels)
```

```{r knitting_setup, echo = F}
param_summary_exp_1 <- readRDS(file = 'data/param_summary_exp_1.RData')
param_summary_exp_2 <- readRDS(file = 'data/param_summary_exp_2.RData')
param_summary_exp_3 <- readRDS(file = 'data/param_summary_exp_3.RData')

#create condition summary data sets 
cond_summary_exp_1 <- compute_condition_summary(param_summary_data = param_summary_exp_1, facet_var = 'measurement_spacing', 
                          ind_vars = c('number_measurements', 'measurement_spacing', 'midpoint'))
cond_summary_exp_2 <- compute_condition_summary(param_summary_data = param_summary_exp_2, facet_var = 'measurement_spacing', 
                  ind_vars = c('number_measurements', 'measurement_spacing', 'sample_size'))
cond_summary_exp_3 <- compute_condition_summary(param_summary_data = param_summary_exp_3, facet_var = 'time_structuredness', 
                          ind_vars = c('number_measurements', 'sample_size', 'time_structuredness'))

#create analytical versions of summary data 
exp_1_analytical <- generate_likert_days_data_sets(summary_data = param_summary_exp_1, exp_num = 1)
exp_2_analytical <- generate_likert_days_data_sets(summary_data = param_summary_exp_2, exp_num = 2)
exp_3_analytical <- generate_likert_days_data_sets(summary_data = param_summary_exp_3, exp_num = 3)
```

```{r echo=F}
exp_1_tables <- create_table_data_sets(param_summary_data = param_summary_exp_1, wide_var = 'midpoint', 
                       first_col = 'measurement_spacing', second_col = 'number_measurements')

exp_2_tables <- create_table_data_sets(param_summary_data = param_summary_exp_2, wide_var = 'sample_size', 
                       first_col = 'measurement_spacing', second_col = 'number_measurements')

exp_3_tables <- create_table_data_sets(param_summary_data = param_summary_exp_3, wide_var = 'sample_size', 
                       first_col = 'time_structuredness', second_col = 'number_measurements') %>%


print_param_table(table_ready_data = exp_1_tables$estimate_table, parameter_name = 'theta', 
            caption_name = 'Parameter Estimate Values in Experiment 1', 
            col_header_name = c('$\\\\uptheta_{fixed}$(lower plateau)', '$\\\\uptheta_{random}$(lower plateau)'), 
            IV_names =  c('Measurement spacing', 'Number of measurements'), 
            column_names = c(80, 180, 280))

print_param_table(table_ready_data = exp_2_tables$estimate_table, parameter_name = 'alpha', 
            caption_name = 'Parameter Estimate Values in Experiment 2', 
            col_header_name = c('$\\\\uptheta_{fixed}$(lower plateau)', '$\\\\uptheta_{random}$(lower plateau)'), 
            IV_names =  c('Measurement spacing', 'Number of measurements'), 
            column_names = c(30, 50, 100, 200, 500, 1000))


print_param_table(table_ready_data = exp_1_tables$removed_value_table, parameter_name = 'alpha', 
            caption_name = 'Number of Removed Values for Each Parameter Estimate in Experiment 1', 
            col_header_name = c('$\\\\uptheta_{fixed}$(lower plateau)', '$\\\\uptheta_{random}$(lower plateau)'), 
            IV_names =  c('Measurement spacing', 'Number of measurements'), 
            column_names = c(80, 180, 280))






```

```{r plot_testing, echo=F, eval=F}

generate_day_likert_facet_plot(analytical_data = exp_1_analytical, target_col = 'measurement_spacing', target_value = 'Equal',
                                x_axis_name = 'Midpoint location (days)', 
                                x_axis_var = 'midpoint', exp_num = 'exp1_', beta_lower = -60, beta_upper = 70, ticks = 10)


generate_day_likert_facet_plot(analytical_data = exp_2_analytical, target_col = 'measurement_spacing', target_value = 'Equal',
                                x_axis_name = 'Sample size (*N*)', 
                                x_axis_var = 'sample_size', exp_num = 'exp2_', beta_lower = 165, beta_upper = 205, ticks = 10)


generate_day_likert_facet_plot(analytical_data = exp_3_analytical, target_col = 'time_structuredness', target_value = 'slow_response', 
                                x_axis_name = 'Sample size (*N*)', 
                                x_axis_var = 'sample_size', exp_num = 'exp3_', beta_lower = 165, beta_upper = 205, ticks = 10)


generate_summary_facet_plot(condition_data = cond_summary_exp_1, x_axis_var = 'midpoint', x_axis_name = 'Midpoint location (days)', 
                            facet_var = 'measurement_spacing', lower_y_limit = -6, upper_y_limit = 18, ticks = 2, exp_num = 'exp1_',
                            num_rows = 2, num_cols = 2, y_axis_name = 'Parameter bias (percentage error', y_axis_var = 'mean_perc_error')


generate_summary_facet_plot(condition_data = cond_summary_exp_2, x_axis_var = 'sample_size', x_axis_name = 'Sample size (*N*)', 
                            facet_var = 'measurement_spacing', lower_y_limit = -6, upper_y_limit = 18, ticks = 2, exp_num = 'exp2_',
                            num_rows = 2, num_cols = 2, y_axis_name = 'Parameter bias (percentage error', y_axis_var = 'mean_perc_error')

generate_summary_facet_plot(condition_data = cond_summary_exp_3, x_axis_var = 'sample_size', x_axis_name = 'Sample size (*N*)', panel_spacing_y = 16,
                            facet_var = 'time_structuredness', lower_y_limit = -6, upper_y_limit = 18, ticks = 2, exp_num = 'exp3_',
                            num_rows = 2, num_cols = 2, y_axis_name = 'Parameter bias (percentage error', y_axis_var = 'mean_perc_error')



```


### Equal spacing

```{r plots_equal_exp1, include=F}
generate_multiple_parameter_facet_plots_exp_1(summary_data = summary_exp_1, spacing = 'Equal', exp_num = 'exp1_', 
                                        x_axis_var = 'midpoint', x_axis_name = 'Midpoint location (days)')
```

Figure \ref{fig:exp1_plot_likert_equal} shows the estimation accuracy in terms of percentage error for each of the nine estimated parameters
when equal spacing is used (error bars represent the middle 95% of estimated values and shaded horizontal lines indicate the population value).
Panels A--E show the estimation accuracy for parameters measured in Likert scale units ($\uptheta$ and $\upalpha$; measured on a range of 1--5)
and Panels F--I show the estimation accuracy for parameters measured in days ($\upbeta$ and $\upgamma$). Note that, in Panel F, estimates for $\upbeta_{fixed}$ are centered around their corresponding population values (80, 180, and 280 days), and so the y-axis represents error (in number of days) from the population value. Estimation of Likert-unit parameters appears to be unaffected, whereas estimation of day-unit parameters appears to incur variability, especially when five measurements are used. For example, if five measurements are taken and the midpoint occurs at 80 days, then a plausible range of values for $upgamma_{fixed}$ (Figure \ref{fig:exp1_plot_likert_equal}F) may plausibly fall between 12.5--27.5 *(compute exact values). In a situation where a study sample data at five time points, estimation of day-based parameters incurs an average of error 5.04 (compute actual value and nest it within text) days, and this decreases (and remains) at ~2 days when seven measurements are taken. 

\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Equal Spacing}
  \label{fig:equal_spacing_exp1}
  \includegraphics{Figures/exp1_plot_likert_equal} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Equal Spacing (continued)}
  \includegraphics{Figures/exp1_plot_days_equal} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of estimated values. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03. Sample size is fixed to 225 (\textit{N} = 225). In Panel F, estimates for $\upbeta_{fixed}$ are centered around their corresponding population values (80, 180, and 280 days), meaning the y-axis represents error (in number of days) from the population value.}}
\end{figure}

### Time-increasing spacing

```{r plots_time_inc_exp1, include=F}
generate_multiple_parameter_facet_plots_exp_1(summary_data = summary_exp_1, spacing = 'time_inc', exp_num = 'exp1_', 
                                        x_axis_var = 'midpoint', x_axis_name = 'Midpoint location (days)', 
                                        ticks = 10, beta_lower = -70, beta_upper = 60) 
```

Figure \ref{fig:exp1_plot_likert_time_inc} shows the estimation accuracy in terms of percentage error for each of the nine estimated parameters when time-increasing spacing is used. In alignment with the overall result in Panel B of Figure \ref{fig:exp1_overall_perc_plot} showing that time-increasing spacing incurs the most error with a late
midpoint (280 days), parameters estimates of $\upalpha_{fixed}$ (Panel C), $\upalpha_{random}$ (Panel D), 

\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Increasing Spacing}
  \label{fig:equal_spacing_exp1}
  \includegraphics{Figures/exp1_plot_likert_time_inc} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Increasing Spacing (continued)}
  \includegraphics{Figures/exp1_plot_days_time_inc} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03. In Panel F, estimates for $\upbeta_{fixed}$ are centered around their corresponding population values (80, 180, and 280 days), meaning the y-axis represents error (in number of days) from the population value.}}
\end{figure}

### Time-decreasing spacing

```{r plots_time_dec_exp1, include=F}
generate_multiple_parameter_facet_plots_exp_1(summary_data = summary_exp_1, spacing = 'time_dec', exp_num = 'exp1_', 
                                        x_axis_var = 'midpoint', x_axis_name = 'Midpoint location (days)', 
                                         ticks = 10, beta_lower = -70, beta_upper = 60) 
```


\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Decreasing Spacing}
  \label{fig:equal_spacing_exp1}
  \includegraphics{Figures/exp1_plot_days_time_dec} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Decreasing Spacing (continued)}
  \includegraphics{Figures/exp1_plot_days_time_dec} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03. In Panel F, estimates for $\upbeta_{fixed}$ are centered around their corresponding population values (80, 180, and 280 days), meaning the y-axis represents error (in number of days) from the population value.}}
\end{figure}

### Middle-and-extreme spacing

```{r plots_mid_ext_exp1, include=F}
generate_multiple_parameter_facet_plots_exp_1(summary_data = summary_exp_1, spacing = 'mid_ext', exp_num = 'exp1_', 
                                        x_axis_var = 'midpoint', x_axis_name = 'Midpoint location (days)', 
                                         ticks = 10, beta_lower = -80, beta_upper = 60) 
```


\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Middle-and-Extreme Spacing}
  \label{fig:equal_spacing_exp1}
  \includegraphics{Figures/exp1_plot_likert_mid_ext} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Middle-and-Extreme Spacing (continued)}
  \includegraphics{Figures/exp1_plot_days_mid_ext} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03. In Panel F, estimates for $\upbeta_{fixed}$ are centered around their corresponding population values (80, 180, and 280 days), meaning the y-axis represents error (in number of days) from the population value.}}
\end{figure}

## Experiment 2

### Overall plot

```{r overall_bias_across_spacing, echo=F, eval=F}
#compute percentage change value for each condition across all parameters 
spacing_summary_exp_2 <- summary_exp_2 %>% 
  group_by(measurement_spacing, number_measurements, sample_size) %>%
  summarize(mean_perc_error = mean(perc_error), 
            mean_lower_ci = mean(lower_ci_perc),
             mean_upper_ci = mean(upper_ci_perc), 
            mean_convergence_perc = mean(num_converged_values)/1e3) %>%
  mutate(measurement_spacing = factor(measurement_spacing, 
                                    levels =  c("Equal", "Time increasing", "Time decreasing", "Middle-extreme"), 
                                    labels = c(bquote(expr = 'bold(A:~Equal)'), bquote(expr = 'bold(B:~Time~Increasing)'), 
                                                      bquote(expr = 'bold(C:~Time~Decreasing)'), bquote(expr = 'bold(D:~Middle~Extreme)'))))

generate_summary_facet_plot(plot_data = spacing_summary_exp_2, num_rows = 2, num_cols = 2, plot_file_name = 'exp2_overall_perc_plot',
                    y_axis_name = 'Parameter bias (percentage error)', y_axis_var = 'mean_perc_error', facet_var = 'measurement_spacing', 
                    panel_spacing_y = 10, legend_direction = 'horizontal', legend_position = c(0.5, 0.5), upper_y_limit = 18, lower_y_limit = -6, x_axis_var = 'sample_size')


```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimation Accuracy Across All Measurement Spacing Conditions}
  \label{fig:plots_mid_ext_exp2}
  \includegraphics{Figures/exp2_overall_perc_plot} 
\end{figure}
```

### Equal spacing

```{r plots_equal_exp2, include=F}
generate_multiple_parameter_facet_plots(summary_data = summary_exp_2, spacing = 'equal', exp_num = 'exp2_')
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Equal Spacing}
  \label{fig:equal_spacing_exp2}
  \includegraphics{Figures/exp2_plot_likert_equal} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Equal Spacing (continued)}
  \includegraphics{Figures/exp2_plot_days_equal} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```

### Time-increasing spacing

```{r plots_time_inc_exp2, include=F}
generate_multiple_parameter_facet_plots(summary_data = summary_exp_2, spacing = 'time_inc', exp_num = 'exp2_', lower_beta = 165, upper_beta = 205)
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Increasing Spacing}
  \label{fig:time_inc_spacing_exp2}
  \includegraphics{Figures/exp2_plot_likert_time_inc} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Increasing Spacing (continued)}
  \includegraphics{Figures/exp2_plot_days_time_inc} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```
### Time-decreasing spacing

```{r plots_time_dec_exp2, include=F}
generate_multiple_parameter_facet_plots(summary_data = summary_exp_2, spacing = 'time_dec', exp_num = 'exp2_', lower_beta = 155, upper_beta = 195)
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Decreasing Spacing}
  \label{fig:plots_time_dec_exp2}
  \includegraphics{Figures/exp2_plot_likert_time_inc} 
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Decreasing Spacing (continued)}
  \includegraphics{Figures/exp2_plot_days_time_dec} 
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```
### Middle-extreme spacing

```{r plots_mid_ext_exp2, include=F}
generate_multiple_parameter_facet_plots(summary_data = summary_exp_2, spacing = 'mid_ext', exp_num = 'exp2_')
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Middle-Extreme Spacing}
  \label{fig:plots_mid_ext_exp2}
  \includegraphics{Figures/exp2_plot_likert_mid_ext} \hfill{}
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Middle-Extreme Spacing (continued)}
  \includegraphics{Figures/exp2_plot_days_mid_ext} \hfill{}
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```
## Experiment 3

### Overall plot

```{r overall_perc_error_time_structuredness, echo=F, eval=F, }
#compute percentage change value for each condition across all parameters 
time_structured_summaary <- summary_exp_3 %>% 
  group_by(number_measurements, sample_size, time_structuredness) %>%
  
  summarize(mean_perc_error = mean(perc_error), 
            mean_lower_ci = mean(lower_ci_perc),
             mean_upper_ci = mean(upper_ci_perc)) %>%
  
  mutate(time_structuredness = factor(time_structuredness, 
                                    levels =  c("time_structured", "fast_response", "slow_response"), 
                                    labels = c(bquote(expr = 'bold(A:~Time~~Structured)'), 
                                               bquote(expr = bold(atop("B: Time Unstructured (Fast", paste("Response)")))), 
                                               bquote(expr =  bold(atop("C: Time Unstructured (Slow", paste("Response)")))))))

generate_summary_facet_plot_ts(plot_data = time_structured_summary, num_rows = 2, num_cols = 2, plot_file_name = 'exp3_overall_perc_plot',
                    y_axis_name = 'Parameter bias (percentage error)', y_axis_var = 'mean_perc_error', facet_var = 'time_structuredness', 
                    panel_spacing_y = 5, legend_direction = 'vertical', legend_position = c(0.63, 0.32), upper_y_limit = 18, lower_y_limit = -6)

```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimation Accuracy Across Time Structuredness Conditions}
  \label{fig:plots_mid_ext_exp2}
  \includegraphics{Figures/exp3_overall_perc_plot} 
\end{figure}
```
### Time-structured data

```{r plots_time_structured_exp3, include=F}
generate_multiple_time_struc_facet_plots(summary_data = summary_exp_3, time_struc = 'time_structured', exp_num = 'exp3_')
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Structured Data}
  \label{fig:equal_spacing_exp2}
  \includegraphics{Figures/exp3_plot_likert_time_structured} 
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Equal Spacing (continued)}
  \includegraphics{Figures/exp3_plot_days_time_structured} 
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```
### Time-unstructured data (fast response)

```{r plots_fast_response_exp2, include=F}
generate_multiple_time_struc_facet_plots(summary_data = summary_exp_3, time_struc = 'fast_response', exp_num = 'exp3_')
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Unstructured Data (Fast Response)}
  \label{fig:equal_spacing_exp2}
  \includegraphics{Figures/exp3_plot_likert_fast_response} 
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Unstructured Data (Fast Response; continued)}
  \includegraphics{Figures/exp3_plot_days_fast_response} 
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```
### Time-unstructured data (slow response)

```{r plots_slow_response_exp2, include=F}
generate_multiple_time_struc_facet_plots(summary_data = summary_exp_3, time_struc = 'slow_response', exp_num = 'exp3_')
```

```{=tex}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Unstructured Data (Slow Response)}
  \label{fig:equal_spacing_exp2}
  \includegraphics{Figures/exp3_plot_likert_slow_response} 
\end{figure}
\addtocounter{figure}{-1}
\begin{figure}[H]
  \caption{Summary of Parameter Estimates for Time-Unstructured Data (Slow Response; continued)}
  \includegraphics{Figures/exp3_plot_days_slow_response} 
\caption*{Note. \textup{Errors bars represent the middle 95\% of parameter estimates. Gray horizontal lines in each panel represent the population value for each parameter. Population values for each parameter are as follows: $\uptheta_{fixed}$ = 3.00, $\upalpha_{fixed}$ = 3.32, $\upbeta_{fixed}$ = 180.00, $\upgamma_{fixed}$ = 20.00, $\uptheta_{random}$ = 0.05, $\upalpha_{random}$ = 0.05, $\upbeta_{random}$ = 10.00, $\upgamma_{random}$ = 4.00, $\upepsilon$ = 0.03.}}
\end{figure}
```



```{r tables, echo=F, warning=F, eval=F}
#Create data.frame for table
packages <- c('parallel', 'data.table')

#outlier removal + generation of table-ready data 
#exp_1_filtered <- remove_outliers(data = exp_1, exp_conditions = c('number_measurements', 'measurement_spacing', 'midpoint'))

##although the bias value increases, it is because the SD decreases and the mean estimated value remains the same
#summary_exp_2 %>%
#  select(1:3, 'sd_estimate_gamma_fixed', 'estimate_gamma_fixed')
#convert to wide format

##table symbols
##shaded gray --> point estimate error is where estimates falls outside of 0.4 SDs 
##celsius symbol = convergence is below 90% (to this to convergence table)
#^number of removed values is above 10% of remaining values or 1000 
#*sd is above 5 days (for beta & gamma) or above half the size of the initially set effect (0.32/2 = 0.16) 

#add convergence information (celsius symbol indicates condition where convergence was below 90%) 
add_convergence_information <- function(latex_data, exp_data) {
  
  #compute convergence success + render in appropriate format 
  conv_success <- compute_convergence_success(data = exp_2) %>%
  pivot_wider(names_from = 'sample_size', values_from = 'conv_success') %>% 
   mutate(measurement_spacing = factor(measurement_spacing, levels = c('equal', 'time_inc', 'time_dec', 'mid_ext'), 
                                      labels = c('Equal', 'Time inceasing', 'Time decreasing', 'Middle-extreme'))) %>%
  arrange(measurement_spacing)

}

exp_2_data_tables <- create_data_tables(exp_data = exp_2_filtered)

exp_filtered <- remove_outliers(data = exp_2)
  
  #convert variance values to SD values for random effect parameters 
  exp_cleaned <- convert_var_to_sd(data = exp_filtered)

  #compute bias values 
bias_values_table <- summary_exp_2 %>%
  select(parameter, 2:4, bias) %>%
  pivot_wider(names_from = parameter, values_from = bias, names_prefix = 'bias_') %>% 
  pivot_wider(names_from = sample_size, values_from = contains('bias'))

removed_values_table <- summary_exp_2 %>%
  select(parameter, 2:4, bias) %>%
  pivot_wider(names_from = parameter, values_from = bias, names_prefix = 'bias_') %>% 
  pivot_wider(names_from = sample_size, values_from = contains('bias'))


  


```
wide_1 %>%
  pivot_wider(names_from = sample_size, values_from = which(str_detect(string = names(wide_1), pattern = c('fixed|rand'))))
  
  mutate(measurement_spacing = factor(measurement_spacing, levels = c('equal', 'time_inc', 'time_dec', 'mid_ext'), 
                                      labels = c('Equal', 'Time inceasing', 'Time decreasing', 'Middle-extreme'))) %>%
  arrange(measurement_spacing)
  
  table_data_removed <- summary_exp %>%
    select(c(1:3), contains('num_removed')) %>%
    pivot_wider(names_from = sample_size, values_from = contains('num_removed')) %>%
     mutate(measurement_spacing = factor(measurement_spacing, levels = c('equal', 'time_inc', 'time_dec', 'mid_ext'), 
                                      labels = c('Equal', 'Time inceasing', 'Time decreasing', 'Middle-extreme'))) %>%
  arrange(measurement_spacing)
  


IV_col_names_index <- which(!str_detect(string = names(exp_2_data_tables$bias_values), pattern = '\\d'))
